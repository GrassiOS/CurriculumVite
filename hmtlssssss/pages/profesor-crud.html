<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Profesor - Sistema CVs Académicos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="../css/styles.css">
    <style>
        .step-wizard {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
        }
        .step-wizard .step {
            padding: 15px 25px;
            border-radius: 50px;
            margin: 0 5px;
            position: relative;
            background-color: #6c757d;
            color: white;
            display: inline-block;
            min-width: 120px;
            text-align: center;
            transition: all 0.3s ease;
        }
        .step-wizard .step.active {
            background-color: #0d6efd;
            transform: scale(1.1);
        }
        .step-wizard .step.completed {
            background-color: #198754;
        }
        .step-wizard .step:not(:last-child)::after {
            content: '';
            position: absolute;
            top: 50%;
            right: -20px;
            width: 40px;
            height: 2px;
            background-color: #dee2e6;
            transform: translateY(-50%);
        }
        .step-wizard .step.completed:not(:last-child)::after {
            background-color: #198754;
        }
        .form-section {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }
        .form-section.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .document-upload-area {
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .document-upload-area:hover {
            border-color: #0d6efd;
            background-color: #f8f9fa;
        }
        .document-upload-area.dragover {
            border-color: #198754;
            background-color: #d1e7dd;
        }
        .contact-row {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #0d6efd;
        }
        .preview-section {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="bg-primary text-white py-3 mb-4">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="mb-0">
                        <i class="bi bi-person-gear me-3"></i>
                        <span id="pageTitle">Nuevo Profesor</span>
                    </h1>
                    <p class="mb-0 opacity-75">Gestión completa de información académica</p>
                </div>
                <div class="col-md-4 text-md-end">
                    <a href="profesores.html" class="btn btn-light">
                        <i class="bi bi-arrow-left me-2"></i>
                        Volver a Lista
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Step Wizard -->
        <div class="step-wizard text-center mb-4">
            <div class="step active" data-step="1">
                <i class="bi bi-person-fill d-block mb-1"></i>
                Información Básica
            </div>
            <div class="step" data-step="2">
                <i class="bi bi-telephone-fill d-block mb-1"></i>
                Contactos
            </div>
            <div class="step" data-step="3">
                <i class="bi bi-cloud-upload-fill d-block mb-1"></i>
                Documentos
            </div>
            <div class="step" data-step="4">
                <i class="bi bi-check2-circle d-block mb-1"></i>
                Confirmar
            </div>
        </div>

        <!-- Main Form -->
        <form id="professorCrudForm" novalidate>
            <input type="hidden" id="profesorId" name="profesorId">
            
            <!-- Step 1: Información Básica -->
            <div class="form-section active" data-step="1">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-person-circle text-primary me-2"></i>
                            Información Personal y Académica
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Nombre <span class="text-danger">*</span></label>
                                <input type="text" name="nombre" class="form-control" required>
                                <div class="invalid-feedback">El nombre es obligatorio.</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Apellido <span class="text-danger">*</span></label>
                                <input type="text" name="apellido" class="form-control" required>
                                <div class="invalid-feedback">El apellido es obligatorio.</div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Foto (URL) <span class="text-danger">*</span></label>
                                <input type="url" name="foto" class="form-control" required placeholder="https://ejemplo.com/foto.jpg">
                                <div class="invalid-feedback">Ingrese una URL válida para la foto.</div>
                                <div class="form-text">URL de la fotografía oficial del profesor</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Cuerpo Académico</label>
                                <select name="cuerpoAcademicoId" class="form-select">
                                    <option value="">Seleccionar cuerpo académico...</option>
                                    <option value="1">Ingeniería de Software</option>
                                    <option value="2">Biomedicina</option>
                                    <option value="3">Derecho Constitucional</option>
                                    <option value="4">Gestión Académica</option>
                                </select>
                                <div class="form-text">Grupo de investigación al que pertenece</div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">URL de Drive Personal <span class="text-danger">*</span></label>
                                <input type="url" name="driveUrl" class="form-control" required placeholder="https://drive.google.com/drive/folders/...">
                                <div class="invalid-feedback">Ingrese una URL válida de Google Drive.</div>
                                <div class="form-text">Carpeta principal de Google Drive del profesor</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Carpeta de Documentos (URL)</label>
                                <input type="url" name="carpetaDocumentosUrl" class="form-control" placeholder="https://drive.google.com/drive/folders/...">
                                <div class="form-text">Carpeta específica para documentos oficiales</div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Semblanza Profesional <span class="text-danger">*</span></label>
                            <textarea name="semblanza" class="form-control" rows="6" required 
                                placeholder="Describa la trayectoria profesional, especialidades, logros destacados, líneas de investigación, etc."></textarea>
                            <div class="invalid-feedback">La semblanza es obligatoria.</div>
                            <div class="form-text">Mínimo 100 caracteres. Descripción profesional completa del académico.</div>
                        </div>

                        <!-- Photo Preview -->
                        <div class="row">
                            <div class="col-md-12">
                                <div class="card bg-light">
                                    <div class="card-body text-center">
                                        <h6 class="text-muted">Vista Previa de Foto</h6>
                                        <img id="photoPreview" src="https://via.placeholder.com/150x150/e9ecef/6c757d?text=Foto" 
                                             class="rounded-circle" style="width: 150px; height: 150px; object-fit: cover;" alt="Preview">
                                        <div class="mt-2">
                                            <small class="text-muted">La foto se actualizará automáticamente al ingresar la URL</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 2: Contactos -->
            <div class="form-section" data-step="2">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-telephone-fill text-primary me-2"></i>
                            Información de Contacto
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle me-2"></i>
                            <strong>Información importante:</strong> Agregue todos los medios de contacto del profesor. 
                            Al menos un email es obligatorio.
                        </div>

                        <div id="contactosContainer">
                            <!-- Los contactos se agregarán dinámicamente -->
                        </div>

                        <div class="text-center mt-4">
                            <div class="dropdown">
                                <button type="button" class="btn btn-primary dropdown-toggle" data-bs-toggle="dropdown">
                                    <i class="bi bi-plus-circle me-2"></i>
                                    Agregar Contacto
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="#" onclick="addContacto('email')">
                                        <i class="bi bi-envelope me-2"></i>Email
                                    </a></li>
                                    <li><a class="dropdown-item" href="#" onclick="addContacto('telefono')">
                                        <i class="bi bi-telephone me-2"></i>Teléfono
                                    </a></li>
                                    <li><a class="dropdown-item" href="#" onclick="addContacto('extension')">
                                        <i class="bi bi-telephone-plus me-2"></i>Extensión
                                    </a></li>
                                    <li><a class="dropdown-item" href="#" onclick="addContacto('oficina')">
                                        <i class="bi bi-geo-alt me-2"></i>Oficina
                                    </a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item" href="#" onclick="addContacto('linkedin')">
                                        <i class="bi bi-linkedin me-2"></i>LinkedIn
                                    </a></li>
                                    <li><a class="dropdown-item" href="#" onclick="addContacto('orcid')">
                                        <i class="bi bi-person-badge me-2"></i>ORCID
                                    </a></li>
                                    <li><a class="dropdown-item" href="#" onclick="addContacto('researchgate')">
                                        <i class="bi bi-globe me-2"></i>ResearchGate
                                    </a></li>
                                    <li><a class="dropdown-item" href="#" onclick="addContacto('google_scholar')">
                                        <i class="bi bi-mortarboard me-2"></i>Google Scholar
                                    </a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 3: Documentos -->
            <div class="form-section" data-step="3">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-cloud-upload-fill text-primary me-2"></i>
                            Documentos del Profesor
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-warning">
                            <i class="bi bi-exclamation-triangle me-2"></i>
                            <strong>Nota:</strong> En esta versión de demostración, simularemos la carga de documentos. 
                            En producción, aquí se integraría con Google Drive API u otro servicio de almacenamiento.
                        </div>

                        <!-- Document Upload Area -->
                        <div class="document-upload-area mb-4" onclick="document.getElementById('fileInput').click()">
                            <i class="bi bi-cloud-upload" style="font-size: 3rem; color: #6c757d;"></i>
                            <h5 class="mt-3 text-muted">Arrastra archivos aquí o haz clic para seleccionar</h5>
                            <p class="text-muted">Documentos permitidos: PDF, DOC, DOCX, JPG, PNG (Max: 10MB)</p>
                            <input type="file" id="fileInput" multiple accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" style="display: none;">
                        </div>

                        <!-- Document Categories -->
                        <div class="row mb-4">
                            <div class="col-md-4">
                                <div class="card border-primary">
                                    <div class="card-body text-center">
                                        <i class="bi bi-file-earmark-person text-primary" style="font-size: 2rem;"></i>
                                        <h6 class="mt-2">CV Académico</h6>
                                        <small class="text-muted">Currículum vitae actualizado</small>
                                        <div class="mt-2">
                                            <button type="button" class="btn btn-sm btn-outline-primary" onclick="uploadDocument('cv')">
                                                <i class="bi bi-plus"></i> Agregar
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card border-success">
                                    <div class="card-body text-center">
                                        <i class="bi bi-file-earmark-text text-success" style="font-size: 2rem;"></i>
                                        <h6 class="mt-2">Certificaciones</h6>
                                        <small class="text-muted">Títulos y certificados</small>
                                        <div class="mt-2">
                                            <button type="button" class="btn btn-sm btn-outline-success" onclick="uploadDocument('certificaciones')">
                                                <i class="bi bi-plus"></i> Agregar
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card border-info">
                                    <div class="card-body text-center">
                                        <i class="bi bi-file-earmark-image text-info" style="font-size: 2rem;"></i>
                                        <h6 class="mt-2">Documentos Oficiales</h6>
                                        <small class="text-muted">Cédulas, reconocimientos</small>
                                        <div class="mt-2">
                                            <button type="button" class="btn btn-sm btn-outline-info" onclick="uploadDocument('oficiales')">
                                                <i class="bi bi-plus"></i> Agregar
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Uploaded Documents List -->
                        <div id="uploadedDocuments">
                            <!-- Los documentos subidos aparecerán aquí -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 4: Confirmación -->
            <div class="form-section" data-step="4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-check2-circle text-success me-2"></i>
                            Confirmar Información
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-success">
                            <i class="bi bi-check-circle me-2"></i>
                            <strong>Revise toda la información antes de guardar.</strong> 
                            Una vez confirmado, se creará el perfil del profesor en el sistema.
                        </div>

                        <div id="confirmationPreview" class="preview-section">
                            <!-- La vista previa se generará dinámicamente -->
                        </div>
                    </div>
                </div>
            </div>
        </form>

        <!-- Navigation Buttons -->
        <div class="row mt-4 mb-5">
            <div class="col-12">
                <div class="d-flex justify-content-between">
                    <button type="button" class="btn btn-outline-secondary" id="prevBtn" onclick="changeStep(-1)" disabled>
                        <i class="bi bi-arrow-left me-2"></i>
                        Anterior
                    </button>
                    <div>
                        <button type="button" class="btn btn-secondary me-2" onclick="saveDraft()">
                            <i class="bi bi-save me-2"></i>
                            Guardar Borrador
                        </button>
                        <button type="button" class="btn btn-primary" id="nextBtn" onclick="changeStep(1)">
                            Siguiente
                            <i class="bi bi-arrow-right ms-2"></i>
                        </button>
                        <button type="button" class="btn btn-success" id="submitBtn" onclick="submitForm()" style="display: none;">
                            <i class="bi bi-check-lg me-2"></i>
                            Guardar Profesor
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../js/main.js"></script>
    <script>
        // Variables globales
        let currentStep = 1;
        const totalSteps = 4;
        let professorData = {
            contactos: [],
            documentos: []
        };
        let editMode = false;

        // Verificar si estamos editando
        function checkEditMode() {
            const urlParams = new URLSearchParams(window.location.search);
            const profesorId = urlParams.get('id');
            
            if (profesorId) {
                editMode = true;
                document.getElementById('pageTitle').textContent = 'Editar Profesor';
                document.getElementById('profesorId').value = profesorId;
                loadProfessorData(profesorId);
            } else {
                // Inicializar con contacto de email por defecto
                addContacto('email');
            }
        }

        // Cargar datos del profesor para edición
        function loadProfessorData(profesorId) {
            // Simulación de datos cargados (en producción sería una llamada API)
            const mockData = {
                profesorId: profesorId,
                nombre: 'Juan',
                apellido: 'Pérez',
                foto: 'https://via.placeholder.com/150',
                semblanza: 'Doctor en Ciencias con especialidad en Tecnología Educativa...',
                driveUrl: 'https://drive.google.com/drive/folders/ejemplo1',
                cuerpoAcademicoId: '1',
                carpetaDocumentosUrl: 'https://drive.google.com/drive/folders/docs1',
                contactos: [
                    { tipoContacto: 'email', valor: 'juan.perez@uabc.edu.mx' },
                    { tipoContacto: 'telefono', valor: '+52 646 123 4567' }
                ]
            };

            // Llenar el formulario
            Object.keys(mockData).forEach(key => {
                if (key !== 'contactos' && key !== 'documentos') {
                    const field = document.querySelector(`[name="${key}"]`);
                    if (field) field.value = mockData[key];
                }
            });

            // Cargar contactos
            professorData.contactos = mockData.contactos;
            renderContactos();
            updatePhotoPreview();
        }

        // Gestión de pasos
        function changeStep(direction) {
            const newStep = currentStep + direction;
            
            if (newStep < 1 || newStep > totalSteps) return;
            
            if (direction > 0 && !validateCurrentStep()) return;
            
            // Ocultar paso actual
            document.querySelector(`[data-step="${currentStep}"]`).classList.remove('active');
            document.querySelector(`.step[data-step="${currentStep}"]`).classList.remove('active');
            
            // Marcar paso como completado si avanzamos
            if (direction > 0) {
                document.querySelector(`.step[data-step="${currentStep}"]`).classList.add('completed');
            }
            
            // Mostrar nuevo paso
            currentStep = newStep;
            document.querySelector(`[data-step="${currentStep}"]`).classList.add('active');
            document.querySelector(`.step[data-step="${currentStep}"]`).classList.add('active');
            
            // Actualizar botones
            updateNavigationButtons();
            
            // Generar vista previa si estamos en el último paso
            if (currentStep === totalSteps) {
                generateConfirmationPreview();
            }
        }

        // Validar paso actual
        function validateCurrentStep() {
            const currentSection = document.querySelector(`[data-step="${currentStep}"]`);
            const requiredFields = currentSection.querySelectorAll('[required]');
            let isValid = true;

            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    field.classList.add('is-invalid');
                    isValid = false;
                } else {
                    field.classList.remove('is-invalid');
                    field.classList.add('is-valid');
                }
            });

            // Validaciones específicas por paso
            if (currentStep === 1) {
                const semblanza = document.querySelector('[name="semblanza"]').value;
                if (semblanza.length < 100) {
                    document.querySelector('[name="semblanza"]').classList.add('is-invalid');
                    isValid = false;
                }
            } else if (currentStep === 2) {
                const hasEmail = professorData.contactos.some(c => c.tipoContacto === 'email' && c.valor.trim());
                if (!hasEmail) {
                    alert('Debe agregar al menos un email de contacto.');
                    isValid = false;
                }
            }

            return isValid;
        }

        // Actualizar botones de navegación
        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const submitBtn = document.getElementById('submitBtn');

            prevBtn.disabled = currentStep === 1;
            
            if (currentStep === totalSteps) {
                nextBtn.style.display = 'none';
                submitBtn.style.display = 'inline-block';
            } else {
                nextBtn.style.display = 'inline-block';
                submitBtn.style.display = 'none';
            }
        }

        // Gestión de contactos
        function addContacto(tipo) {
            const contactoObj = {
                id: Date.now(),
                tipoContacto: tipo,
                valor: ''
            };
            
            professorData.contactos.push(contactoObj);
            renderContactos();
        }

        function removeContacto(id) {
            professorData.contactos = professorData.contactos.filter(c => c.id !== id);
            renderContactos();
        }

        function renderContactos() {
            const container = document.getElementById('contactosContainer');
            
            if (professorData.contactos.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-muted py-4">
                        <i class="bi bi-person-x" style="font-size: 3rem;"></i>
                        <p class="mt-2">No hay contactos agregados</p>
                        <small>Utilice el botón "Agregar Contacto" para comenzar</small>
                    </div>
                `;
                return;
            }

            container.innerHTML = professorData.contactos.map(contacto => {
                const iconMap = {
                    'email': 'envelope',
                    'telefono': 'telephone',
                    'extension': 'telephone-plus',
                    'oficina': 'geo-alt',
                    'linkedin': 'linkedin',
                    'orcid': 'person-badge',
                    'researchgate': 'globe',
                    'google_scholar': 'mortarboard'
                };
                
                const icon = iconMap[contacto.tipoContacto] || 'info-circle';
                const label = contacto.tipoContacto.charAt(0).toUpperCase() + contacto.tipoContacto.slice(1).replace('_', ' ');
                const placeholder = getContactPlaceholder(contacto.tipoContacto);
                
                return `
                    <div class="contact-row">
                        <div class="row align-items-center">
                            <div class="col-md-2">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-${icon} text-primary me-2"></i>
                                    <strong>${label}</strong>
                                </div>
                            </div>
                            <div class="col-md-8">
                                <input type="${contacto.tipoContacto === 'email' ? 'email' : 'text'}" 
                                       class="form-control" 
                                       placeholder="${placeholder}"
                                       value="${contacto.valor}"
                                       onchange="updateContacto(${contacto.id}, this.value)"
                                       ${contacto.tipoContacto === 'email' ? 'required' : ''}>
                            </div>
                            <div class="col-md-2 text-end">
                                <button type="button" class="btn btn-outline-danger btn-sm" onclick="removeContacto(${contacto.id})">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getContactPlaceholder(tipo) {
            const placeholders = {
                'email': 'nombre@institucion.edu.mx',
                'telefono': '+52 646 123 4567',
                'extension': '1234',
                'oficina': 'Edificio A, Cubículo 201',
                'linkedin': 'usuario-linkedin',
                'orcid': '0000-0000-0000-0000',
                'researchgate': 'Nombre_Usuario',
                'google_scholar': 'ID o URL del perfil'
            };
            return placeholders[tipo] || 'Ingrese valor';
        }

        function updateContacto(id, valor) {
            const contacto = professorData.contactos.find(c => c.id === id);
            if (contacto) {
                contacto.valor = valor;
            }
        }

        // Gestión de documentos
        function uploadDocument(categoria) {
            // Simulación de carga de documento
            const documento = {
                id: Date.now(),
                categoria: categoria,
                nombre: `Documento_${categoria}_${Date.now()}.pdf`,
                url: `https://drive.google.com/file/simulated/${Date.now()}`,
                fechaSubida: new Date().toISOString(),
                tamaño: Math.floor(Math.random() * 5000) + 100 // KB
            };
            
            professorData.documentos.push(documento);
            renderDocuments();
        }

        function renderDocuments() {
            const container = document.getElementById('uploadedDocuments');
            
            if (professorData.documentos.length === 0) {
                container.innerHTML = '';
                return;
            }

            container.innerHTML = `
                <h6 class="mb-3">Documentos Subidos</h6>
                <div class="list-group">
                    ${professorData.documentos.map(doc => `
                        <div class="list-group-item">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-1">${doc.nombre}</h6>
                                    <small class="text-muted">
                                        Categoría: ${doc.categoria} | Tamaño: ${doc.tamaño}KB | 
                                        Subido: ${new Date(doc.fechaSubida).toLocaleDateString()}
                                    </small>
                                </div>
                                <div>
                                    <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeDocument(${doc.id})">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function removeDocument(id) {
            professorData.documentos = professorData.documentos.filter(d => d.id !== id);
            renderDocuments();
        }

        // Vista previa de foto
        function updatePhotoPreview() {
            const fotoUrl = document.querySelector('[name="foto"]').value;
            const preview = document.getElementById('photoPreview');
            
            if (fotoUrl) {
                preview.src = fotoUrl;
                preview.onerror = () => {
                    preview.src = 'https://via.placeholder.com/150x150/e9ecef/6c757d?text=Error';
                };
            }
        }

        // Generar vista previa de confirmación
        function generateConfirmationPreview() {
            const formData = new FormData(document.getElementById('professorCrudForm'));
            const preview = document.getElementById('confirmationPreview');
            
            const data = {};
            for (let [key, value] of formData.entries()) {
                data[key] = value;
            }

            preview.innerHTML = `
                <div class="row">
                    <div class="col-md-4 text-center">
                        <img src="${data.foto || 'https://via.placeholder.com/150'}" 
                             class="rounded-circle mb-3" 
                             style="width: 150px; height: 150px; object-fit: cover;" 
                             alt="Foto del profesor">
                        <h5>${data.nombre} ${data.apellido}</h5>
                    </div>
                    <div class="col-md-8">
                        <h6>Información Personal</h6>
                        <p><strong>Nombre completo:</strong> ${data.nombre} ${data.apellido}</p>
                        <p><strong>Cuerpo Académico:</strong> ${getCuerpoAcademicoName(data.cuerpoAcademicoId)}</p>
                        <p><strong>Drive URL:</strong> <a href="${data.driveUrl}" target="_blank">${data.driveUrl}</a></p>
                        ${data.carpetaDocumentosUrl ? `<p><strong>Carpeta Documentos:</strong> <a href="${data.carpetaDocumentosUrl}" target="_blank">Ver carpeta</a></p>` : ''}
                        
                        <h6 class="mt-3">Semblanza</h6>
                        <p class="text-muted">${data.semblanza}</p>
                        
                        <h6 class="mt-3">Contactos (${professorData.contactos.length})</h6>
                        ${professorData.contactos.map(c => `<p><strong>${c.tipoContacto}:</strong> ${c.valor}</p>`).join('')}
                        
                        <h6 class="mt-3">Documentos (${professorData.documentos.length})</h6>
                        ${professorData.documentos.map(d => `<p><i class="bi bi-file-earmark"></i> ${d.nombre}</p>`).join('')}
                    </div>
                </div>
            `;
        }

        function getCuerpoAcademicoName(id) {
            const nombres = {
                '1': 'Ingeniería de Software',
                '2': 'Biomedicina',
                '3': 'Derecho Constitucional',
                '4': 'Gestión Académica'
            };
            return nombres[id] || 'Sin asignar';
        }

        // Guardar borrador
        function saveDraft() {
            const formData = new FormData(document.getElementById('professorCrudForm'));
            const data = Object.fromEntries(formData.entries());
            data.contactos = professorData.contactos;
            data.documentos = professorData.documentos;
            
            localStorage.setItem('professorDraft', JSON.stringify(data));
            
            const toast = document.createElement('div');
            toast.className = 'toast align-items-center text-white bg-success border-0 position-fixed top-0 end-0 m-3';
            toast.style.zIndex = '9999';
            toast.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">
                        <i class="bi bi-check-circle me-2"></i>
                        Borrador guardado exitosamente
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                </div>
            `;
            document.body.appendChild(toast);
            new bootstrap.Toast(toast).show();
        }

        // Enviar formulario
        function submitForm() {
            if (!validateCurrentStep()) return;
            
            const formData = new FormData(document.getElementById('professorCrudForm'));
            const data = Object.fromEntries(formData.entries());
            data.contactos = professorData.contactos;
            data.documentos = professorData.documentos;
            
            // Simulación de envío
            console.log('Datos a enviar:', data);
            
            // Mostrar mensaje de éxito
            const successModal = new bootstrap.Modal(document.createElement('div'));
            const modalElement = document.createElement('div');
            modalElement.className = 'modal fade';
            modalElement.innerHTML = `
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header bg-success text-white">
                            <h5 class="modal-title">
                                <i class="bi bi-check-circle me-2"></i>
                                ${editMode ? 'Profesor Actualizado' : 'Profesor Creado'}
                            </h5>
                        </div>
                        <div class="modal-body text-center">
                            <i class="bi bi-check-circle-fill text-success" style="font-size: 3rem;"></i>
                            <h5 class="mt-3">¡Operación Exitosa!</h5>
                            <p>El profesor ${data.nombre} ${data.apellido} ha sido ${editMode ? 'actualizado' : 'creado'} correctamente.</p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-primary" onclick="window.location.href='profesores.html'">
                                Volver a Lista
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="window.location.href='profesor-crud.html'">
                                Crear Otro
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modalElement);
            new bootstrap.Modal(modalElement).show();
            
            // Limpiar borrador
            localStorage.removeItem('professorDraft');
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            checkEditMode();
            updateNavigationButtons();
            
            // Event listener para cambio de foto
            document.querySelector('[name="foto"]').addEventListener('input', updatePhotoPreview);
            
            // Drag and drop para documentos
            const uploadArea = document.querySelector('.document-upload-area');
            
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                handleFileUpload(files);
            });
            
            // File input change
            document.getElementById('fileInput').addEventListener('change', (e) => {
                handleFileUpload(e.target.files);
            });
        });

        // Manejar carga de archivos
        function handleFileUpload(files) {
            Array.from(files).forEach(file => {
                // Validación de archivo
                const validTypes = ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document', 'image/jpeg', 'image/png'];
                const maxSize = 10 * 1024 * 1024; // 10MB
                
                if (!validTypes.includes(file.type)) {
                    alert(`Archivo ${file.name} no es un tipo válido.`);
                    return;
                }
                
                if (file.size > maxSize) {
                    alert(`Archivo ${file.name} es demasiado grande (máx. 10MB).`);
                    return;
                }
                
                // Simular carga
                const documento = {
                    id: Date.now() + Math.random(),
                    categoria: 'general',
                    nombre: file.name,
                    url: `https://drive.google.com/file/simulated/${Date.now()}`,
                    fechaSubida: new Date().toISOString(),
                    tamaño: Math.round(file.size / 1024)
                };
                
                professorData.documentos.push(documento);
                renderDocuments();
            });
        }
    </script>
</body>
</html> 