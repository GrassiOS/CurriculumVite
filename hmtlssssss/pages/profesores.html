<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Profesores - Sistema CVs Académicos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="../css/styles.css">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .main-header {
            background: linear-gradient(135deg, #1B4D3E 0%, #2D6A4F 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }
        .stats-card {
            transition: transform 0.2s;
        }
        .stats-card:hover {
            transform: translateY(-5px);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="main-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="mb-2">
                        <i class="bi bi-person-circle me-3"></i>
                        Gestión de Profesores
                    </h1>
                    <p class="mb-0 opacity-75">Sistema de gestión de currículums vitae académicos</p>
                </div>
                <div class="col-md-4 text-md-end">
                    <a href="profesor-crud.html" class="btn btn-light btn-lg">
                        <i class="bi bi-plus-lg me-2"></i>
                        Nuevo Profesor
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container">
        <!-- Quick Stats -->
        <div class="row mb-4">
            <div class="col-md-3 mb-3">
                <div class="card stats-card bg-primary text-white">
                    <div class="card-body text-center">
                        <i class="bi bi-people" style="font-size: 2rem;"></i>
                        <h4 class="mt-2 mb-1" id="totalProfesores">0</h4>
                        <small>Total Profesores</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card stats-card bg-success text-white">
                    <div class="card-body text-center">
                        <i class="bi bi-journal-text" style="font-size: 2rem;"></i>
                        <h4 class="mt-2 mb-1" id="totalPublicaciones">0</h4>
                        <small>Publicaciones</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card stats-card bg-info text-white">
                    <div class="card-body text-center">
                        <i class="bi bi-lightbulb" style="font-size: 2rem;"></i>
                        <h4 class="mt-2 mb-1" id="totalProyectos">0</h4>
                        <small>Proyectos</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card stats-card bg-warning text-white">
                    <div class="card-body text-center">
                        <i class="bi bi-file-earmark-text" style="font-size: 2rem;"></i>
                        <h4 class="mt-2 mb-1" id="totalTesis">0</h4>
                        <small>Tesis Dirigidas</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Search and Filter -->
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="input-group">
                    <input type="text" id="searchInput" class="form-control" placeholder="Buscar profesor...">
                    <button class="btn btn-outline-secondary" type="button">
                        <i class="bi bi-search"></i>
                    </button>
                </div>
            </div>
            <div class="col-md-4">
                <select class="form-select" id="cuerpoAcademicoFilter">
                    <option value="">Todos los Cuerpos Académicos</option>
                    <option value="1">Ingeniería de Software</option>
                    <option value="2">Biomedicina</option>
                    <option value="3">Derecho Constitucional</option>
                    <option value="4">Gestión Académica</option>
                </select>
            </div>
            <div class="col-md-4 text-end">
                <div class="btn-group">
                    <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                        <i class="bi bi-funnel"></i> Filtrar
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item" href="#" data-filter="all">Todos</a></li>
                        <li><a class="dropdown-item" href="#" data-filter="active">Con CV Completo</a></li>
                        <li><a class="dropdown-item" href="#" data-filter="incomplete">CV Incompleto</a></li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Professors List -->
        <div class="card shadow">
            <div class="card-header bg-white">
                <div class="row align-items-center">
                    <div class="col">
                        <h5 class="mb-0">Lista de Profesores</h5>
                    </div>
                    <div class="col-auto">
                        <span class="badge bg-primary" id="professorCount">0 profesores</span>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="list-group list-group-flush" id="professorsContainer">
                    <!-- Los profesores se cargarán aquí dinámicamente -->
                </div>
            </div>
        </div>

        <!-- Pagination -->
        <div class="row mt-4">
            <div class="col-md-12">
                <nav>
                    <ul class="pagination justify-content-center" id="pagination">
                        <!-- La paginación se generará dinámicamente -->
                    </ul>
                </nav>
            </div>
        </div>
    </div>

    <!-- Professor Detail Modal -->
    <div class="modal fade" id="professorDetailModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="detailModalTitle">Detalles del Profesor</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="detailModalBody">
                    <!-- Content will be loaded dynamically -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-primary" id="editProfessorBtn">
                        <i class="bi bi-pencil me-2"></i>
                        Editar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../js/main.js"></script>
    <script>
    // Datos de ejemplo ajustados a la nueva estructura de BD
    const profesores = [
        {
            profesorId: 1,
            nombre: 'Juan',
            apellido: 'Pérez',
            foto: 'https://via.placeholder.com/150',
            semblanza: 'Doctor en Ciencias con especialidad en Tecnología Educativa. Profesor titular con más de 15 años de experiencia en docencia e investigación.',
            driveUrl: 'https://drive.google.com/drive/folders/ejemplo1',
            cuerpoAcademicoId: 1,
            cuerpoAcademico: 'Ingeniería de Software',
            carpetaDocumentosUrl: 'https://drive.google.com/drive/folders/docs1',
            contactos: [
                { tipoContacto: 'email', valor: 'juan.perez@institucion.edu' },
                { tipoContacto: 'telefono', valor: '+52 646 123 4567' },
                { tipoContacto: 'extension', valor: '1234' },
                { tipoContacto: 'oficina', valor: 'Edificio A, Cubículo 201' }
            ],
            publicaciones: 25,
            proyectos: 8,
            tesis: 12,
            distinciones: 3
        },
        {
            profesorId: 2,
            nombre: 'María',
            apellido: 'López',
            foto: 'https://randomuser.me/api/portraits/women/32.jpg',
            semblanza: 'Doctora en Biomedicina con especialidad en Genética. Investigadora Senior con reconocimiento internacional en proyectos biomédicos.',
            driveUrl: 'https://drive.google.com/drive/folders/ejemplo2',
            cuerpoAcademicoId: 2,
            cuerpoAcademico: 'Biomedicina',
            carpetaDocumentosUrl: 'https://drive.google.com/drive/folders/docs2',
            contactos: [
                { tipoContacto: 'email', valor: 'maria.lopez@institucion.edu' },
                { tipoContacto: 'telefono', valor: '+52 555 987 6543' },
                { tipoContacto: 'orcid', valor: '0000-0002-1234-5678' },
                { tipoContacto: 'researchgate', valor: 'MariaLopez_Research' }
            ],
            publicaciones: 40,
            proyectos: 12,
            tesis: 18,
            distinciones: 7
        },
        {
            profesorId: 3,
            nombre: 'Carlos',
            apellido: 'Ramírez',
            foto: 'https://randomuser.me/api/portraits/men/45.jpg',
            semblanza: 'Doctor en Derecho con especialidad en Derecho Constitucional. Profesor investigador con amplia experiencia en litigio constitucional.',
            driveUrl: 'https://drive.google.com/drive/folders/ejemplo3',
            cuerpoAcademicoId: 3,
            cuerpoAcademico: 'Derecho Constitucional',
            carpetaDocumentosUrl: null,
            contactos: [
                { tipoContacto: 'email', valor: 'carlos.ramirez@institucion.edu' },
                { tipoContacto: 'telefono', valor: '+52 333 222 1111' },
                { tipoContacto: 'oficina', valor: 'Edificio B, Despacho 305' }
            ],
            publicaciones: 15,
            proyectos: 3,
            tesis: 5,
            distinciones: 2
        },
        {
            profesorId: 4,
            nombre: 'Sofía',
            apellido: 'Torres',
            foto: 'https://randomuser.me/api/portraits/women/65.jpg',
            semblanza: 'Maestra en Ingeniería con especialidad en Gestión de Procesos. Coordinadora Académica con experiencia en optimización y mejora continua.',
            driveUrl: 'https://drive.google.com/drive/folders/ejemplo4',
            cuerpoAcademicoId: 4,
            cuerpoAcademico: 'Gestión Académica',
            carpetaDocumentosUrl: 'https://drive.google.com/drive/folders/docs4',
            contactos: [
                { tipoContacto: 'email', valor: 'sofia.torres@institucion.edu' },
                { tipoContacto: 'telefono', valor: '+52 818 555 1234' },
                { tipoContacto: 'linkedin', valor: 'sofia-torres-academic' },
                { tipoContacto: 'extension', valor: '5678' }
            ],
            publicaciones: 10,
            proyectos: 5,
            tesis: 8,
            distinciones: 1
        }
    ];

    // Variables globales
    let currentPage = 1;
    const itemsPerPage = 10;
    let filteredProfesores = [...profesores];

    // Calcular y mostrar estadísticas
    function updateStats() {
        const stats = {
            totalProfesores: profesores.length,
            totalPublicaciones: profesores.reduce((sum, p) => sum + p.publicaciones, 0),
            totalProyectos: profesores.reduce((sum, p) => sum + p.proyectos, 0),
            totalTesis: profesores.reduce((sum, p) => sum + p.tesis, 0)
        };

        document.getElementById('totalProfesores').textContent = stats.totalProfesores;
        document.getElementById('totalPublicaciones').textContent = stats.totalPublicaciones;
        document.getElementById('totalProyectos').textContent = stats.totalProyectos;
        document.getElementById('totalTesis').textContent = stats.totalTesis;
        document.getElementById('professorCount').textContent = `${filteredProfesores.length} profesores`;
    }

    // Función para renderizar la lista de profesores
    function renderProfessors() {
        const container = document.getElementById('professorsContainer');
        const startIndex = (currentPage - 1) * itemsPerPage;
        const endIndex = startIndex + itemsPerPage;
        const professorsToShow = filteredProfesores.slice(startIndex, endIndex);

        container.innerHTML = professorsToShow.map(profesor => {
            const emailContacto = profesor.contactos.find(c => c.tipoContacto === 'email');
            const telefonoContacto = profesor.contactos.find(c => c.tipoContacto === 'telefono');
            const oficinaContacto = profesor.contactos.find(c => c.tipoContacto === 'oficina');
            
            const completitud = calculateCompleteness(profesor);
            const badgeClass = completitud >= 80 ? 'bg-success' : completitud >= 50 ? 'bg-warning' : 'bg-danger';
            
            return `
                <div class="list-group-item d-flex align-items-center justify-content-between flex-wrap flex-md-nowrap py-3">
                    <div class="d-flex align-items-center flex-grow-1" style="min-width:200px;">
                        <img src="${profesor.foto}" class="rounded-circle me-3" alt="Foto" style="width: 60px; height: 60px; object-fit: cover;">
                        <div>
                            <button class="btn btn-link p-0 profesor-nombre-link fw-bold mb-0" onclick="showProfessorDetail(${profesor.profesorId})">
                                ${profesor.nombre} ${profesor.apellido}
                            </button>
                            <div class="text-muted small">${emailContacto ? emailContacto.valor : 'Sin email'}</div>
                            <div class="text-muted small">${profesor.cuerpoAcademico || 'Sin cuerpo académico'}</div>
                        </div>
                    </div>
                    <div class="flex-grow-1 text-md-center" style="min-width:200px;">
                        <div class="small text-muted mb-1">Actividad Académica</div>
                        <div class="d-flex justify-content-center gap-3">
                            <span class="badge bg-primary">${profesor.publicaciones} Pub.</span>
                            <span class="badge bg-info">${profesor.proyectos} Proy.</span>
                            <span class="badge bg-secondary">${profesor.tesis} Tesis</span>
                            <span class="badge bg-warning">${profesor.distinciones} Dist.</span>
                        </div>
                    </div>
                    <div class="text-md-end" style="min-width:120px;">
                        <div class="small text-muted mb-1">Contacto</div>
                        <div class="small">
                            ${telefonoContacto ? `<i class="bi bi-telephone"></i> ${telefonoContacto.valor}` : 'Sin teléfono'}
                        </div>
                        ${oficinaContacto ? `<div class="small text-muted">${oficinaContacto.valor}</div>` : ''}
                    </div>
                    <div class="px-3">
                        <span class="badge ${badgeClass}">${completitud}% CV</span>
                    </div>
                    <div class="d-flex align-items-center justify-content-center">
                        <button class="btn btn-outline-primary btn-sm me-1" title="Ver" onclick="showProfessorDetail(${profesor.profesorId})">
                            <i class="bi bi-eye"></i>
                        </button>
                        <a href="profesor-crud.html?id=${profesor.profesorId}" class="btn btn-outline-warning btn-sm me-1" title="Editar">
                            <i class="bi bi-pencil"></i>
                        </a>
                        <button class="btn btn-outline-danger btn-sm" title="Eliminar" onclick="deleteProfesor(${profesor.profesorId})">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
            `;
        }).join('');

        updateStats();
        renderPagination();
    }

    // Función para mostrar detalles del profesor en modal
    function showProfessorDetail(id) {
        const profesor = profesores.find(p => p.profesorId === id);
        if (!profesor) return;

        const modal = new bootstrap.Modal(document.getElementById('professorDetailModal'));
        document.getElementById('detailModalTitle').textContent = `${profesor.nombre} ${profesor.apellido}`;
        
        const contactosHtml = profesor.contactos.map(contacto => {
            const iconMap = {
                'email': 'envelope',
                'telefono': 'telephone',
                'extension': 'telephone-plus',
                'oficina': 'geo-alt',
                'linkedin': 'linkedin',
                'orcid': 'person-badge',
                'researchgate': 'globe',
                'google_scholar': 'mortarboard'
            };
            
            const icon = iconMap[contacto.tipoContacto] || 'info-circle';
            const label = contacto.tipoContacto.charAt(0).toUpperCase() + contacto.tipoContacto.slice(1);
            
            return `
                <p class="mb-2">
                    <i class="bi bi-${icon} text-primary me-2"></i>
                    <strong>${label}:</strong> ${contacto.valor}
                </p>
            `;
        }).join('');

        document.getElementById('detailModalBody').innerHTML = `
            <div class="row">
                <div class="col-md-4 text-center">
                    <img src="${profesor.foto}" class="rounded-circle mb-3" alt="Foto" style="width: 150px; height: 150px; object-fit: cover;">
                    <h5>${profesor.nombre} ${profesor.apellido}</h5>
                    <p class="text-muted">${profesor.cuerpoAcademico || 'Sin cuerpo académico'}</p>
                </div>
                <div class="col-md-8">
                    <h6>Semblanza</h6>
                    <p>${profesor.semblanza}</p>
                    
                    <h6 class="mt-3">Contacto</h6>
                    ${contactosHtml}
                    
                    <h6 class="mt-3">Estadísticas</h6>
                    <div class="row">
                        <div class="col-6">
                            <div class="text-center p-2 bg-light rounded">
                                <h5 class="mb-1">${profesor.publicaciones}</h5>
                                <small>Publicaciones</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="text-center p-2 bg-light rounded">
                                <h5 class="mb-1">${profesor.proyectos}</h5>
                                <small>Proyectos</small>
                            </div>
                        </div>
                    </div>
                    
                    ${profesor.driveUrl ? `
                        <div class="mt-3">
                            <a href="${profesor.driveUrl}" target="_blank" class="btn btn-outline-primary">
                                <i class="bi bi-cloud me-2"></i>
                                Ver Drive
                            </a>
                        </div>
                    ` : ''}
                </div>
            </div>
        `;

        modal.show();
    }

    // Función para calcular completitud del CV
    function calculateCompleteness(profesor) {
        let completeness = 0;
        const factors = [
            { condition: profesor.nombre && profesor.apellido, weight: 10 },
            { condition: profesor.foto, weight: 5 },
            { condition: profesor.semblanza, weight: 10 },
            { condition: profesor.driveUrl, weight: 5 },
            { condition: profesor.cuerpoAcademicoId, weight: 10 },
            { condition: profesor.contactos.some(c => c.tipoContacto === 'email'), weight: 10 },
            { condition: profesor.publicaciones > 0, weight: 15 },
            { condition: profesor.proyectos > 0, weight: 15 },
            { condition: profesor.tesis > 0, weight: 10 },
            { condition: profesor.distinciones > 0, weight: 10 }
        ];

        factors.forEach(factor => {
            if (factor.condition) {
                completeness += factor.weight;
            }
        });

        return Math.min(100, completeness);
    }

    // Función para renderizar paginación
    function renderPagination() {
        const totalPages = Math.ceil(filteredProfesores.length / itemsPerPage);
        const pagination = document.getElementById('pagination');
        
        if (totalPages <= 1) {
            pagination.innerHTML = '';
            return;
        }

        let paginationHTML = '';
        
        // Botón anterior
        paginationHTML += `
            <li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
                <a class="page-link" href="#" onclick="changePage(${currentPage - 1})">Anterior</a>
            </li>
        `;

        // Números de página
        for (let i = 1; i <= totalPages; i++) {
            paginationHTML += `
                <li class="page-item ${i === currentPage ? 'active' : ''}">
                    <a class="page-link" href="#" onclick="changePage(${i})">${i}</a>
                </li>
            `;
        }

        // Botón siguiente
        paginationHTML += `
            <li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
                <a class="page-link" href="#" onclick="changePage(${currentPage + 1})">Siguiente</a>
            </li>
        `;

        pagination.innerHTML = paginationHTML;
    }

    // Función para cambiar página
    function changePage(page) {
        const totalPages = Math.ceil(filteredProfesores.length / itemsPerPage);
        if (page >= 1 && page <= totalPages) {
            currentPage = page;
            renderProfessors();
        }
    }

    // Función de búsqueda
    function filterProfessors() {
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        const cuerpoAcademico = document.getElementById('cuerpoAcademicoFilter').value;

        filteredProfesores = profesores.filter(profesor => {
            const matchesSearch = 
                profesor.nombre.toLowerCase().includes(searchTerm) ||
                profesor.apellido.toLowerCase().includes(searchTerm) ||
                profesor.semblanza.toLowerCase().includes(searchTerm) ||
                profesor.contactos.some(c => c.valor.toLowerCase().includes(searchTerm));

            const matchesCuerpoAcademico = !cuerpoAcademico || 
                profesor.cuerpoAcademicoId == cuerpoAcademico;

            return matchesSearch && matchesCuerpoAcademico;
        });

        currentPage = 1;
        renderProfessors();
    }

    // Funciones CRUD
    function editProfesor(id) {
        // Implementar edición
        console.log('Editar profesor:', id);
    }

    function deleteProfesor(id) {
        if (confirm('¿Está seguro de que desea eliminar este profesor?')) {
            // Implementar eliminación
            console.log('Eliminar profesor:', id);
        }
    }

    // Inicialización
    document.addEventListener('DOMContentLoaded', function() {
        renderProfessors();

        // Event listeners para filtros
        document.getElementById('searchInput').addEventListener('input', filterProfessors);
        document.getElementById('cuerpoAcademicoFilter').addEventListener('change', filterProfessors);

        // Event listeners para filtros de dropdown
        document.querySelectorAll('[data-filter]').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const filter = this.getAttribute('data-filter');
                
                if (filter === 'all') {
                    filteredProfesores = [...profesores];
                } else if (filter === 'active') {
                    filteredProfesores = profesores.filter(p => calculateCompleteness(p) >= 80);
                } else if (filter === 'incomplete') {
                    filteredProfesores = profesores.filter(p => calculateCompleteness(p) < 50);
                }
                
                currentPage = 1;
                renderProfessors();
            });
        });
    });
    </script>
</body>
</html> 